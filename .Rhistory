colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)])
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_const_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_trend_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/const_none_p2.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/const_const_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/const_trend_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
colMeans(cbind(RESULTS), na.rm=TRUE)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/trend_none_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/trend_const_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/trend_const_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/trend_trend_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
load("~/Downloads/ML-2/Sim_R1000_n100_d0.75_nu1_ar_high.RData")
load("~/Downloads/ML-2/Sim_R1000_n100_d0.75_nu1_ar_high.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS
load("~/Downloads/ML-2/Sim_R1000_n100_d0.75_nu1_ar_high.RData")
RESULTS <- t(RESULTS)
head(RESULTS)
load("~/Downloads/ML-2/Sim_R1000_n100_d0.75_nu1_ar_high_corr.RData")
RESULTS
RESULTS <- t(RESULTS)
RESULTS
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 20)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
load("~/Downloads/ML-2/Sim_R1000_n100_d1_nu1_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], 0.5)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu1_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Downloads/ML-2/Sim_R1000_n100_d1.75_nu1_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Downloads/ML-2/Sim_R1000_n100_d1.75_nu5_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Downloads/ML-2/Sim_R1000_n100_d1.75_nu10_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Downloads/ML-2/Sim_R1000_n200_d1.75_nu10_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Downloads/ML-2/Sim_R1000_n300_d1.75_nu10_ar_high_corr.RData")
load("~/Downloads/ML-2/Sim_R1000_n300_d1.75_nu5_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
#
load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_none_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_const_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_trend_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/const_none_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/const_const_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/const_trend_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/trend_none_p2_corr.RData")
#
#load("~/Downloads/ML-2/Sim_R1000_n100_d1.25_nu10_ar_high_corr.RData")
#RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
#
load("~/Downloads/ML-2/Sim_R1000_n200_d1.25_nu10_ar_high_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
View(RESULTS)
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
15.4*12
48293 - 46963
1330/11
121*12
1631*0.2077
1631*0.2077 + 184.8
1631*0.3137 + 184.8
1631*0.3137
696.44-538.94
538.94/12
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_none_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
View(RESULTS)
lm(RESULTS[,2] ~ RESULTS[,8])
lm(RESULTS[,2] ~ RESULTS[,8]) %>% summary
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_none_p2_corr.RData")
RESULTS <- t(RESULTS)
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
RESULTS
load("~/Dokumente/Projekte/Filtering unknown persistence/R/Applications/pseudo/none_none_p2_corr.RData")
RESULTS <- RESULTS[!is.na(RESULTS[,1]), ]
RESULTS <- cbind(RESULTS, apply(RESULTS[, 3:5], 1, function(x) cov2cor(mlogvech2mat(x))[2,1]))
colMeans(RESULTS)
hist(RESULTS[, ncol(RESULTS)], breaks = 50)
quantile(RESULTS[, ncol(RESULTS)], c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9))
old <- RESULTS
48*12
XX <- rnorm(1000)
XX <- cbind(rnorm(1000), rnorm(1000))
y <- XX %*% c(1, 2)
solve(t(XX)%*%XX)
chol2inv(chol(XX))
chol2inv(chol(t(XX)%*%XX))
?lm.fit
lm.fit
C_Cdqrls
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d1_nu1_ar_high_ML.RData")
View(RESULTS)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n300_d1.75_nu10_ar_high_corr.RData")
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d0.75_nu1_ar_high_ML.RData")
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d0.75_nu1_ar_high_corr.RData")
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d1.25_nu1_ar_high_corr.RData")
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d0.75_nu1_ar_high_corr copy.RData")
RESULTS2 <- RESULTS
rowMeans(RESULTS2)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d0.75_nu1_ar_high_corr.RData")
rowMeans(RESULTS)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d0.75_nu1_ar_high_corr.RData")
rowMeans(RESULTS)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d1_nu1_ar_high_corr.RData")
rowMeans(RESULTS)
load("~/Dokumente/Projekte/Filtering unknown persistence/R/MC/MC_server/Integer/ML/Sim_R1000_n100_d1.25_nu1_ar_high_corr.RData")
rowMeans(RESULTS)
library(dplyr)
# aus eviews gruppe "alle_prognosen" -> markieren und copy (Strg + C)
dat <- read.table("clipboard", header = FALSE) %>% setNames(c("Date", "Anzeigen Konj-KUG saisonbereinigt","Konj-KUG saisonbereinigt", "Konjunktur-KUG", "Transfer-KUG",	"Saison-KUG",	"Zusammen"))
dat
load("~/Dokumente/Projekte/unit_roots/R/1_RESULTS_new.RData")
View(RESULTS)
3699 + 196 + 135 + 62 + 32
84.7+110.39+115.64
# Simulation:
# Performance of fUC for parameter estimation
#   - High and normal signal to noise ratios
#   - AR plus non-AR
#   - compare d with other nonparametric estimators
gc()
rm(list = ls())
library(fUCpack)
library(dplyr)
library(parallel)
# Wd, etc
setwd("~/Dokumente/Projekte/filtering unknown persistence/R/code")
# Settings
n <- c(100, 200, 300)
d <- c(0.75, 1, 1.75)
ratio <- c(1, 10, 30, 0, 0.1)
R <- 1000
# Strong persistence
ar <- c(-1.6, 0.8)
# Long-run variance part
cvar <- function(ar){
p <- length(ar)
A <- toComp(-ar)$CompMat
return(matrix(solve(diag(p^2)-(A%x%A))%*%c(1,rep(0,p^2-1)),p,p)[1,1])
}
xvar <- function(n, d){
pisq <- frac_diff(c(1, rep(0, n-1)), -d)^2
var  <- cumsum(pisq)
return(mean(var))
}
setups <- expand.grid(n, d, ratio)
colnames(setups) <- c("n", "d", "ratio")
setups <- setups[order(setups[, "n"]), ]
# calculate the true nu:
nucalc <- function(n, d, ratio, ar){
if(ratio == 0) return(1)
var_x <- xvar(n, d)
var_c <- cvar(ar)
nu    <- var_x/var_c * (1 / ratio)
return(nu)
}
# get nu
nuc <- sapply(1:nrow(setups), function(x) nucalc(setups[x, 1], setups[x, 2], setups[x, 3], ar))
i=1
setup <- setups[ i, ]
n <- as.numeric(setup[1])
d <- as.numeric(setup[2])
nu <- nucalc(n, d, setups[i, 3], ar)
r <- setups[i, 3]
cat("Iteration ", i, "\n")
# check if simulation is already done
if(file.exists(file = paste("./MC/Sim_R", R, "_n", n, "_d", d, "_r", r, "_corr0.RData", sep=""))) next
set.seed(42)
# Generate the data
x <- frac_diff_multi(matrix(rnorm(n*R, mean=0, sd=1), n, R), -d)
u <- matrix(rnorm(n*R, mean=0, sd=sqrt(nu)), n, R)
c <- apply(u, 2, function(x) stats::filter(c(rep(0, length(ar)), x), filter = c(-ar), method = "recursive", sides = 1)[-(1:length(ar))])
y <- yy<-x + c
# grid of starting values
d.grid <- seq(0.75, 1.75, 0.25)
nu_grid <- c(0.01, 1, 100, 1000) %>% log()
ar.1.grid <- c(-1.8,  -1.6, -1.4)
ar2.grid  <- c(0.6,  0.8,  1)
gr.start <- expand.grid(d.grid, nu_grid, ar.1.grid, ar2.grid) %>% as.matrix()
gr.start <- gr.start[sapply(1:nrow(gr.start), function(i) toComp(-c(gr.start[i, 3:4]))$stable) ,]
optfn <- function(n, y, x){
tryCatch({
# Estimate
# check grid
grid.st <- cbind(gr.start, sapply(1:nrow(gr.start), function(i) fUC_opt(gr.start[i, ],
y=y, START = 1,
nulim = c(1/100, 1e+06),
deterministics = FALSE)))
par0 <- grid.st[which.min(grid.st[,5]),-5]
(est <- optim(par=par0, control = list(),
fn = fUC_opt, quiet = TRUE, START = 1,
y=y, method = "BFGS", nulim = c(1/100, 1e+06), d.int = c(0.5, 2.5),
deterministics = FALSE))
# check for corner solutions: d->0, d->2, nu->1/100, nu->1000000
j=1
while(est$par[1] < .05 | est$par[1] > 1.95 | exp(est$par[2]) < 0.01 | exp(est$par[2]) > 250000){
if(j > 10) break
j=j+1
par0 <- grid.st[order(grid.st[,5]),-5][j , ]
(est <- optim(par=par0,
fn = fUC_opt, quiet = TRUE, d.int = c(0.5, 2.5),
y=y, method = "BFGS", nulim = c(1/100, 1e+06),
deterministics = FALSE, START = 1))
}
par <- est$par
nu  <- exp(par[2])
ar <- est$par[-(1:2)]
#KF <- fUC_comp(y, par[1], nu, ar)
#KF2 <- fUC_comp((1:length(y))^par[1], par[1], nu, ar)
#mu  <- summary(lm(KF$v ~ -1 + KF2$v))$coefficients[1,1]
KS <- fUC_smooth(y, par[1], nu, ar = ar, corr = FALSE)
Rsq <- summary(lm(x ~ KS$x))$r.squared
# Return results
results <- c(par[1], exp(par[2]), ar, Rsq)
names(results) <- c("d", "nu", "ar_1", "ar_2", "Rsq")
return(results)
}, error = function(e) return(rep(NA, 5))
)
}
### fUC part
cl <- makeCluster(32)
# Simulation:
# Performance of fUC for parameter estimation
#   - High and normal signal to noise ratios
#   - AR plus non-AR
#   - compare d with other nonparametric estimators
gc()
rm(list = ls())
library(fUCpack)
library(dplyr)
# Simulation:
# Performance of fUC for parameter estimation
#   - High and normal signal to noise ratios
#   - AR plus non-AR
#   - compare d with other nonparametric estimators
gc()
rm(list = ls())
library(fUCpack)
library(dplyr)
install.packages("dplyr")
library(dplyr)
library(parallel)
# Wd, etc
setwd("~/Dokumente/Projekte/filtering unknown persistence/R/code")
# Settings
n <- c(100, 200, 300)
d <- c(0.75, 1, 1.75)
ratio <- c(1, 10, 30, 0, 0.1)
R <- 1000
# Strong persistence
ar <- c(-1.6, 0.8)
# Long-run variance part
cvar <- function(ar){
p <- length(ar)
A <- toComp(-ar)$CompMat
return(matrix(solve(diag(p^2)-(A%x%A))%*%c(1,rep(0,p^2-1)),p,p)[1,1])
}
xvar <- function(n, d){
pisq <- frac_diff(c(1, rep(0, n-1)), -d)^2
var  <- cumsum(pisq)
return(mean(var))
}
setups <- expand.grid(n, d, ratio)
colnames(setups) <- c("n", "d", "ratio")
setups <- setups[order(setups[, "n"]), ]
# calculate the true nu:
nucalc <- function(n, d, ratio, ar){
if(ratio == 0) return(1)
var_x <- xvar(n, d)
var_c <- cvar(ar)
nu    <- var_x/var_c * (1 / ratio)
return(nu)
}
# get nu
nuc <- sapply(1:nrow(setups), function(x) nucalc(setups[x, 1], setups[x, 2], setups[x, 3], ar))
i=1
setup <- setups[ i, ]
n <- as.numeric(setup[1])
d <- as.numeric(setup[2])
nu <- nucalc(n, d, setups[i, 3], ar)
r <- setups[i, 3]
cat("Iteration ", i, "\n")
# check if simulation is already done
if(file.exists(file = paste("./MC/Sim_R", R, "_n", n, "_d", d, "_r", r, "_corr0.RData", sep=""))) next
# Simulation:
# Performance of fUC for parameter estimation
#   - High and normal signal to noise ratios
#   - AR plus non-AR
#   - compare d with other nonparametric estimators
gc()
rm(list = ls())
library(fUCpack)
library(dplyr)
library(parallel)
# Wd, etc
setwd("~/Dokumente/Projekte/filtering unknown persistence/R/code")
# Settings
n <- c(100, 200, 300)
d <- c(0.75, 1, 1.75)
ratio <- c(1, 10, 30, 0, 0.1)
R <- 1000
# Strong persistence
ar <- c(-1.6, 0.8)
# Weaker persistemce
#ar <- c(-0.9, 0.4)
# Long-run variance part
cvar <- function(ar){
p <- length(ar)
A <- toComp(-ar)$CompMat
return(matrix(solve(diag(p^2)-(A%x%A))%*%c(1,rep(0,p^2-1)),p,p)[1,1])
}
xvar <- function(n, d){
pisq <- frac_diff(c(1, rep(0, n-1)), -d)^2
var  <- cumsum(pisq)
return(mean(var))
}
setups <- expand.grid(n, d, ratio)
# calculate variance ratio for grid
colnames(setups) <- c("n", "d", "ratio")
setups <- setups[order(setups[, "n"]), ]
# calculate the true nu:
nucalc <- function(n, d, ratio, ar){
if(ratio == 0) return(1)
var_x <- xvar(n, d)
var_c <- cvar(ar)
nu    <- var_x/var_c * (1 / ratio)
return(nu)
}
# get nu
nuc <- sapply(1:nrow(setups), function(x) nucalc(setups[x, 1], setups[x, 2], setups[x, 3], ar))
setup <- setups[ i, ]
n <- as.numeric(setup[1])
d <- as.numeric(setup[2])
nu <- nucalc(n, d, setups[i, 3], ar)
r <- setups[i, 3]
cat("Iteration ", i, "\n")
i=1
setup <- setups[ i, ]
n <- as.numeric(setup[1])
d <- as.numeric(setup[2])
nu <- nucalc(n, d, setups[i, 3], ar)
r <- setups[i, 3]
cat("Iteration ", i, "\n")
# check if simulation is already done
if(file.exists(file = paste("./MC/Sim_R", R, "_n", n, "_d", d, "_r", r, "_corr0_trendbreak.RData", sep=""))) next
set.seed(42)
# Generate the data
x <- frac_diff_multi(matrix(rnorm(n*R, mean=0, sd=1), n, R), -d)
u <- matrix(rnorm(n*R, mean=0, sd=sqrt(nu)), n, R)
c <- apply(u, 2, function(x) stats::filter(c(rep(0, length(ar)), x), filter = c(-ar), method = "recursive", sides = 1)[-(1:length(ar))])
y <- yy<-x + c
# add a linear time trend
trend <- (1/r) * (1:n) - (1/(2*r))* c(rep(0, floor(n/2)), 1:(n-floor(n/2)))
y <- y + trend
# grid of starting values
d.grid <- seq(0.75, 1.75, 0.25)
nu_grid <- c(0.01, 1, 100, 1000) %>% log()
ar.1.grid <- c(-1.8,  -1.6, -1.4)
ar2.grid  <- c(0.6,  0.8,  1)
nu_grid <- log(c(0.01, 1, 100, 1000))
ar.1.grid <- c(-1.8,  -1.6, -1.4)
ar2.grid  <- c(0.6,  0.8,  1)
gr.start <- expand.grid(d.grid, nu_grid, ar.1.grid, ar2.grid) %>% as.matrix()
library(dplyr)
